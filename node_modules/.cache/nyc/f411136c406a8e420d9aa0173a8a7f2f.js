var cov_203njo6s66=function(){var path="C:\\Users\\Ajcat\\Desktop\\CPEN491-Capstone\\SeaChangeBackendServer\\endpoints\\db.js",hash="7373d8442bc36e933d11db4173116732f83a4663",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"C:\\Users\\Ajcat\\Desktop\\CPEN491-Capstone\\SeaChangeBackendServer\\endpoints\\db.js",statementMap:{"0":{start:{line:4,column:16},end:{line:4,column:34}},"1":{start:{line:5,column:11},end:{line:5,column:38}},"2":{start:{line:6,column:14},end:{line:6,column:44}},"3":{start:{line:7,column:15},end:{line:7,column:31}},"4":{start:{line:9,column:28},end:{line:9,column:92}},"5":{start:{line:10,column:27},end:{line:10,column:87}},"6":{start:{line:13,column:0},end:{line:52,column:3}},"7":{start:{line:15,column:4},end:{line:51,column:11}},"8":{start:{line:18,column:27},end:{line:18,column:40}},"9":{start:{line:19,column:25},end:{line:19,column:27}},"10":{start:{line:21,column:12},end:{line:26,column:13}},"11":{start:{line:22,column:16},end:{line:25,column:58}},"12":{start:{line:29,column:40},end:{line:37,column:87}},"13":{start:{line:39,column:12},end:{line:47,column:15}},"14":{start:{line:40,column:16},end:{line:46,column:17}},"15":{start:{line:41,column:20},end:{line:41,column:77}},"16":{start:{line:42,column:20},end:{line:42,column:95}},"17":{start:{line:44,column:20},end:{line:44,column:73}},"18":{start:{line:45,column:20},end:{line:45,column:46}},"19":{start:{line:50,column:12},end:{line:50,column:43}},"20":{start:{line:55,column:0},end:{line:123,column:3}},"21":{start:{line:56,column:4},end:{line:121,column:11}},"22":{start:{line:59,column:27},end:{line:59,column:40}},"23":{start:{line:60,column:25},end:{line:60,column:27}},"24":{start:{line:62,column:12},end:{line:76,column:13}},"25":{start:{line:63,column:16},end:{line:75,column:58}},"26":{start:{line:79,column:40},end:{line:107,column:87}},"27":{start:{line:109,column:12},end:{line:117,column:15}},"28":{start:{line:110,column:16},end:{line:116,column:17}},"29":{start:{line:111,column:20},end:{line:111,column:77}},"30":{start:{line:112,column:20},end:{line:112,column:95}},"31":{start:{line:114,column:20},end:{line:114,column:73}},"32":{start:{line:115,column:20},end:{line:115,column:46}},"33":{start:{line:120,column:12},end:{line:120,column:43}},"34":{start:{line:126,column:0},end:{line:129,column:3}},"35":{start:{line:127,column:4},end:{line:127,column:13}},"36":{start:{line:128,column:4},end:{line:128,column:45}},"37":{start:{line:131,column:1},end:{line:131,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:31},end:{line:13,column:32}},loc:{start:{line:13,column:51},end:{line:52,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:8},end:{line:16,column:9}},loc:{start:{line:16,column:28},end:{line:48,column:9}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:39,column:52},end:{line:39,column:53}},loc:{start:{line:39,column:81},end:{line:47,column:13}},line:39},"3":{name:"(anonymous_3)",decl:{start:{line:49,column:8},end:{line:49,column:9}},loc:{start:{line:49,column:28},end:{line:51,column:9}},line:49},"4":{name:"(anonymous_4)",decl:{start:{line:55,column:30},end:{line:55,column:31}},loc:{start:{line:55,column:50},end:{line:123,column:1}},line:55},"5":{name:"(anonymous_5)",decl:{start:{line:57,column:8},end:{line:57,column:9}},loc:{start:{line:57,column:28},end:{line:118,column:9}},line:57},"6":{name:"(anonymous_6)",decl:{start:{line:109,column:52},end:{line:109,column:53}},loc:{start:{line:109,column:81},end:{line:117,column:13}},line:109},"7":{name:"(anonymous_7)",decl:{start:{line:119,column:8},end:{line:119,column:9}},loc:{start:{line:119,column:28},end:{line:121,column:9}},line:119},"8":{name:"(anonymous_8)",decl:{start:{line:126,column:26},end:{line:126,column:27}},loc:{start:{line:126,column:46},end:{line:129,column:1}},line:126}},branchMap:{"0":{loc:{start:{line:40,column:16},end:{line:46,column:17}},type:"if",locations:[{start:{line:40,column:16},end:{line:46,column:17}},{start:{line:40,column:16},end:{line:46,column:17}}],line:40},"1":{loc:{start:{line:110,column:16},end:{line:116,column:17}},type:"if",locations:[{start:{line:110,column:16},end:{line:116,column:17}},{start:{line:110,column:16},end:{line:116,column:17}}],line:110}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();// DB ENDPOINT ROUTES
// ===============================================
const express=(cov_203njo6s66.s[0]++,require('express'));const db=(cov_203njo6s66.s[1]++,require('../components/db'));const axios=(cov_203njo6s66.s[2]++,require('../components/axios'));const router=(cov_203njo6s66.s[3]++,express.Router());const fishBaseFaoAreasUrl=(cov_203njo6s66.s[4]++,"https://fishbase.ropensci.org/faoareas/?limit=5000&AreaCode=67");const fishBaseSpeciesUrl=(cov_203njo6s66.s[5]++,"https://fishbase.ropensci.org/species/?limit=5000&offset=0");/* GET. To update the faoareas table in the db */cov_203njo6s66.s[6]++;router.get('/update/faoareas',function(req,res){cov_203njo6s66.f[0]++;cov_203njo6s66.s[7]++;axios.getRequest(fishBaseFaoAreasUrl,function(response){cov_203njo6s66.f[1]++;var jsonData=(cov_203njo6s66.s[8]++,response.data);var values=(cov_203njo6s66.s[9]++,[]);cov_203njo6s66.s[10]++;for(var i=0;i<jsonData.length;i++){cov_203njo6s66.s[11]++;values.push([jsonData[i].autoctr,jsonData[i].AreaCode,jsonData[i].SpecCode,jsonData[i].StockCode,jsonData[i].Status,jsonData[i].Entered,jsonData[i].DateEntered,jsonData[i].Modified,jsonData[i].DateModified,jsonData[i].Expert,jsonData[i].DateChecked,jsonData[i].TS]);}//TODO: Need to figure out best way to store this long query
const insertOrUpdateQuery=(cov_203njo6s66.s[12]++,`INSERT INTO ebdb.FaoAreas (autoctr, AreaCode, SpecCode, StockCode, 
                                                                Status, Entered, DateEntered, Modified,
                                                                DateModified, Expert, DateChecked, TS) 
                                      VALUES ? ON DUPLICATE KEY UPDATE AreaCode = VALUES(AreaCode), SpecCode = VALUES(SpecCode),
                                                                       StockCode = VALUES(StockCode), Status = VALUES(Status),
                                                                       Entered = VALUES(Entered), DateEntered = VALUES(DateEntered),
                                                                       Modified = VALUES(Modified), DateModified = VALUES(DateModified),
                                                                       Expert = VALUES(Expert), DateChecked = VALUES(DateChecked),
                                                                       TS = VALUES(TS)`);cov_203njo6s66.s[13]++;db.query(insertOrUpdateQuery,[values],function(err,rows,fields){cov_203njo6s66.f[2]++;cov_203njo6s66.s[14]++;if(!err){cov_203njo6s66.b[0][0]++;cov_203njo6s66.s[15]++;console.log('Data are updated or inserted successfully');cov_203njo6s66.s[16]++;res.status(200).send('SUCCESS: Data are updated or inserted successfully');}else{cov_203njo6s66.b[0][1]++;cov_203njo6s66.s[17]++;console.log('Error while performing INSERT/UPDATE.');cov_203njo6s66.s[18]++;res.status(500).send(err);}});},function(errorMsg){cov_203njo6s66.f[3]++;cov_203njo6s66.s[19]++;res.status(500).send(errorMsg);});});/* GET. To update the species table in the db */cov_203njo6s66.s[20]++;router.get('/update/species',function(req,res){cov_203njo6s66.f[4]++;cov_203njo6s66.s[21]++;axios.getRequest(fishBaseSpeciesUrl,function(response){cov_203njo6s66.f[5]++;var jsonData=(cov_203njo6s66.s[22]++,response.data);var values=(cov_203njo6s66.s[23]++,[]);cov_203njo6s66.s[24]++;for(var i=0;i<jsonData.length;i++){cov_203njo6s66.s[25]++;values.push([jsonData[i].SpecCode,jsonData[i].Genus,jsonData[i].Species,jsonData[i].SpeciesRefNo,jsonData[i].Author,jsonData[i].FBname,jsonData[i].PicPreferredName,jsonData[i].FamCode,jsonData[i].Subfamily,jsonData[i].GenCode,jsonData[i].BodyShapeI,jsonData[i].Source,jsonData[i].TaxIssue,jsonData[i].Fresh,jsonData[i].Brack,jsonData[i].Saltwater,jsonData[i].DemersPelag,jsonData[i].Amphibious,jsonData[i].AnaCat,jsonData[i].MigratRef,jsonData[i].Vulnerability,jsonData[i].Length,jsonData[i].LTypeMaxM,jsonData[i].MaxLengthRef,jsonData[i].Weight,jsonData[i].UsedforAquaculture,jsonData[i].LifeCycle,jsonData[i].UsedasBait,jsonData[i].Aquarium,jsonData[i].Dangerous,jsonData[i].Electrogenic,jsonData[i].Comments,jsonData[i].Entered,jsonData[i].DateEntered,jsonData[i].Modified,jsonData[i].DateModified,jsonData[i].Expert,jsonData[i].DateChecked,jsonData[i].TS]);}//TODO: Need to figure out best way to store this long query
const insertOrUpdateQuery=(cov_203njo6s66.s[26]++,`INSERT INTO ebdb.Species (SpecCode, Genus, Species, SpeciesRefNo, 
                                                                Author, FBname, PicPreferredName, FamCode,
                                                                Subfamily, GenCode, BodyShapeI, Source,
                                                                TaxIssue, Fresh, Brack, Saltwater,
                                                                DemersPelag, Amphibious, AnaCat, MigratRef,
                                                                Vulnerability, Length, LTypeMaxM, MaxLengthRef,
                                                                Weight, UsedforAquaculture, LifeCycle, UsedasBait,
                                                                Aquarium, Dangerous, Electrogenic, Comments,
                                                                Entered, DateEntered, Modified, DateModified,
                                                                Expert, DateChecked, TS) 
                                      VALUES ? ON DUPLICATE KEY UPDATE Genus = VALUES(Genus), Species = VALUES(Species),
                                                                       SpeciesRefNo = VALUES(SpeciesRefNo), Author = VALUES(Author),
                                                                       FBname = VALUES(FBname), PicPreferredName = VALUES(PicPreferredName),
                                                                       FamCode = VALUES(FamCode), Subfamily = VALUES(Subfamily),
                                                                       GenCode = VALUES(GenCode), BodyShapeI = VALUES(BodyShapeI),
                                                                       TaxIssue = VALUES(TaxIssue), Fresh = VALUES(Fresh),
                                                                       Brack = VALUES(Brack), Saltwater = VALUES(Saltwater),
                                                                       DemersPelag = VALUES(DemersPelag), Amphibious = VALUES(Amphibious),
                                                                       AnaCat = VALUES(AnaCat), MigratRef = VALUES(MigratRef),
                                                                       Vulnerability = VALUES(Vulnerability), Length = VALUES(Length),
                                                                       LTypeMaxM = VALUES(LTypeMaxM), MaxLengthRef = VALUES(MaxLengthRef),
                                                                       Weight = VALUES(Weight), UsedforAquaculture = VALUES(UsedforAquaculture),
                                                                       LifeCycle = VALUES(LifeCycle), UsedasBait = VALUES(UsedasBait),
                                                                       Aquarium = VALUES(Aquarium), Dangerous = VALUES(Dangerous),
                                                                       Electrogenic = VALUES(Electrogenic), Comments = VALUES(Comments),
                                                                       Entered = VALUES(Entered), DateEntered = VALUES(DateEntered),
                                                                       Modified = VALUES(Modified), DateModified = VALUES(DateModified),
                                                                       Expert = VALUES(Expert), DateChecked = VALUES(DateChecked),
                                                                       TS = VALUES(TS)`);cov_203njo6s66.s[27]++;db.query(insertOrUpdateQuery,[values],function(err,rows,fields){cov_203njo6s66.f[6]++;cov_203njo6s66.s[28]++;if(!err){cov_203njo6s66.b[1][0]++;cov_203njo6s66.s[29]++;console.log('Data are updated or inserted successfully');cov_203njo6s66.s[30]++;res.status(200).send('SUCCESS: Data are updated or inserted successfully');}else{cov_203njo6s66.b[1][1]++;cov_203njo6s66.s[31]++;console.log('Error while performing INSERT/UPDATE.');cov_203njo6s66.s[32]++;res.status(500).send(err);}});},function(errorMsg){cov_203njo6s66.f[7]++;cov_203njo6s66.s[33]++;res.status(500).send(errorMsg);});});//TODO: ONLY FOR DEBUGGING, REMOVE THIS LATER SINCE IT IS DANGEROUS.
cov_203njo6s66.s[34]++;router.get('/disconnect',function(req,res){cov_203njo6s66.f[8]++;cov_203njo6s66.s[35]++;db.end();cov_203njo6s66.s[36]++;console.log('Disconnected to database.');});cov_203njo6s66.s[37]++;module.exports=router;